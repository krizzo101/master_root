# CREATE/UPDATE ADR WORKFLOW

expectation: adr_generated_and_saved_in_standard_format
completion: adr_file_created_and_committed

directives:
  - "This workflow must be followed exactly. Do not skip or improvise steps."
  - "The agent must operate in fully autonomous, persistent mode."
  - "All ADRs must follow the standard format and be saved in /home/opsvi/agent_world/docs/applications/ACCF/architecture/adr/."
  - "Validate all operations and document every major design decision."

references:
  Profile: .cursor/profiles/create_update_adr_agent_profile.yml
  Output_Template: .cursor/templates/create_update_adr_output_template.yml
  Standards: [https://adr.github.io/]

phases:
  profile_initialization:
    description: "Load the agent profile, perform a time check, and load foundational rules."
    tools: [read_file, fetch_rules, mcp_time_current_time]
    steps:
      - tool: mcp_time_current_time
        validation: time_checked
      - tool: read_file
        params:
          target_file: .cursor/profiles/create_update_adr_agent_profile.yml
        validation: agent_profile_loaded
      - tool: fetch_rules
        params:
          rule_names:
            - "002-tool-usage-and-optimize"
            - "200-project-design-and-dev-process"
            - "501-tool-operation-validation"
            - "300-documentation-standards"
        validation: foundational_rules_loaded
    gates: [time_checked, agent_profile_loaded, foundational_rules_loaded]

  intake:
    description: "Capture the design decision context and intended ADR filename."
    tools: [prompt_user]
    steps:
      - intention_analysis → adr_request → adr_context_identified
      - context_capture → filename_analysis → adr_filename_confirmed
    gates: [adr_context_identified, adr_filename_confirmed]

  input_validation:
    description: "Validate the design decision context and filename."
    tools: [prompt_user]
    steps:
      - validate_context_completeness → context_validated
      - validate_filename_format → filename_validated
    gates: [context_validated, filename_validated]

  adr_generation:
    description: "Generate the ADR in standard format using the output template."
    tools: [edit_file, read_file]
    steps:
      - tool: read_file
        params:
          target_file: .cursor/templates/create_update_adr_output_template.yml
        validation: output_template_loaded
      - populate_template_with_context → adr_draft_created
      - tool: edit_file
        params:
          target_file: /home/opsvi/agent_world/docs/applications/ACCF/architecture/adr/[adr_filename].md
          code_edit: generated_adr_content
        validation: adr_file_created
    gates: [output_template_loaded, adr_draft_created, adr_file_created]

  review:
    description: "Review the generated ADR for completeness, standards compliance, and accuracy."
    tools: [read_file, fetch_rules]
    steps:
      - tool: read_file
        params:
          target_file: /home/opsvi/agent_world/docs/applications/ACCF/architecture/adr/[adr_filename].md
        validation: adr_reviewed
      - checklist_review:
          - standard_format
          - required_sections_present
          - actionable_decision
          - references_and_participants
        validation: compliance_confirmed
    gates: [adr_reviewed, compliance_confirmed]

  linting:
    description: "Lint and auto-fix the ADR markdown file."
    tools: [run_terminal_cmd]
    steps:
      - tool: run_terminal_cmd
        params:
          command: "markdownlint-cli2 --fix /home/opsvi/agent_world/docs/applications/ACCF/architecture/adr/[adr_filename].md"
          is_background: false
        validation: linting_passed
    gates: [linting_passed]

  documentation:
    description: "Document the workflow execution and commit the ADR."
    tools: [edit_file, run_terminal_cmd]
    steps:
      - tool: edit_file
        params:
          target_file: docs/applications/ACCF/standards/create_update_adr_workflow.md
          code_edit: generated_workflow_documentation
        validation: workflow_doc_created
      - tool: run_terminal_cmd
        params:
          command: "git add . && git commit -m 'Add/update ADR: [adr_filename]'"
          is_background: false
        validation: git_commit_successful
    gates: [workflow_doc_created, git_commit_successful]
