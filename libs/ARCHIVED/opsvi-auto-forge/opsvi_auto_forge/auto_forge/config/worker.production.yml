# Production Worker Configuration
worker:
  concurrency: 4
  prefetch_multiplier: 1
  max_tasks_per_child: 1000
  task_time_limit: 1800  # 30 minutes
  task_soft_time_limit: 1500  # 25 minutes
  worker_disable_rate_limits: false
  worker_max_memory_per_child: 200000  # 200MB

# Celery Configuration
celery:
  broker_url: "redis://autonomous-factory-redis:6379/1"
  result_backend: "redis://autonomous-factory-redis:6379/2"
  task_serializer: "json"
  accept_content: ["json"]
  result_serializer: "json"
  timezone: "UTC"
  enable_utc: true
  task_track_started: true
  task_ignore_result: false
  task_store_errors_even_if_ignored: true
  worker_send_task_events: true
  task_send_sent_event: true
  event_queue_expires: 60
  worker_cancel_long_running_tasks_on_connection_loss: true

# Queue Configuration
queues:
  default:
    name: "default"
    priority: 0
    concurrency: 2
  high_priority:
    name: "high-priority"
    priority: 10
    concurrency: 2
  low_priority:
    name: "low-priority"
    priority: -10
    concurrency: 1

# Database Configuration
database:
  neo4j:
    uri: "bolt://autonomous-factory-neo4j:7687"
    user: "neo4j"
    password: "${NEO4J_PASSWORD}"
    max_connection_pool_size: 20
    connection_timeout: 30
    max_transaction_retry_time: 15
    encrypted: true

# Redis Configuration
redis:
  url: "redis://autonomous-factory-redis:6379"
  password: "${REDIS_PASSWORD}"
  db: 0
  max_connections: 10
  socket_timeout: 5
  socket_connect_timeout: 5
  retry_on_timeout: true

# Logging Configuration
logging:
  level: "INFO"
  format: "json"
  enable_file: true
  log_file: "/app/logs/worker.log"
  enable_audit_log: true
  audit_log_file: "/app/logs/worker_audit.log"
  max_file_size: "100MB"
  backup_count: 5

# Monitoring Configuration
monitoring:
  prometheus_enabled: true
  metrics_enabled: true
  health_check_interval: 30
  system_metrics_interval: 15
  task_metrics_enabled: true
  queue_metrics_enabled: true

# Task Configuration
tasks:
  default_timeout: 1800  # 30 minutes
  max_retries: 3
  retry_delay: 60  # seconds
  retry_backoff: true
  retry_backoff_max: 600  # 10 minutes
  retry_jitter: true
  priority_levels: ["low", "normal", "high", "critical"]
  task_routes:
    "auto_forge.application.orchestrator.tasks.*": {"queue": "high-priority"}
    "auto_forge.infrastructure.workers.tasks.*": {"queue": "default"}
    "*.low_priority": {"queue": "low-priority"}

# Performance Configuration
performance:
  worker_prefetch_multiplier: 1
  worker_direct: false
  worker_redirect_stdouts: true
  worker_redirect_stdouts_level: "WARNING"
  worker_hijack_root_logger: false
  worker_log_color: false
  worker_log_format: "[%(asctime)s: %(levelname)s/%(processName)s] %(message)s"

# Error Handling
error_handling:
  task_remote_tracebacks: true
  task_always_eager: false
  task_eager_propagates: true
  task_ignore_result: false
  task_store_errors_even_if_ignored: true
  task_serializer: "json"
  accept_content: ["json"]

# Security Configuration
security:
  worker_disable_rate_limits: false
  worker_max_memory_per_child: 200000  # 200MB
  worker_max_tasks_per_child: 1000
  worker_timer_precision: 1.0
  worker_timer_soft_time_limit: 1500  # 25 minutes

# Feature Flags
features:
  task_execution_enabled: true
  monitoring_enabled: true
  audit_logging_enabled: true
  health_checks_enabled: true
  metrics_collection_enabled: true
  task_retry_enabled: true
  task_timeout_enabled: true
